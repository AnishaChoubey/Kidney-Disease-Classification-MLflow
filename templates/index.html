<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Object Classification</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <style>
    body {
      background: #f4f6fb;
      font-family: "Segoe UI", Tahoma, sans-serif;
    }

    h3 {
      font-weight: 700;
      color: #2d3e70;
    }

    .card {
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border: none;
    }

    .upload-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .preview-box {
      width: 100%;
      max-width: 350px;
      height: 300px;
      border: 2px dashed #2d3e70;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
      overflow: hidden;
      margin-bottom: 15px;
    }

    .preview-box img,
    .preview-box video {
      max-width: 100%;
      max-height: 100%;
    }

    .btn-group-custom button {
      border-radius: 30px;
      padding: 8px 20px;
      font-weight: 600;
    }

    .results-box {
      padding: 15px;
      border-radius: 12px;
      background: #fff;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
      height: 310px;
      overflow-y: auto;
    }

    .loader {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #2d3e70;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: auto;
      display: none;
    }

    @keyframes spin {
      0% {transform: rotate(0deg);}
      100% {transform: rotate(360deg);}
    }

  </style>
</head>
<body>
<div class="container py-5">
  <h3 class="text-center mb-5">âš¡ Object Classification</h3>

  <div class="row">
    <!-- Upload Section -->
    <div class="col-md-6 mb-4">
      <div class="card p-4">
        <div class="upload-area">
          <div class="preview-box">
            <video autoplay id="video" poster="https://img.freepik.com/free-vector/group-young-people-posing-photo_52683-18824.jpg"></video>
            <img src="" id="photo" style="display:none;">
            <canvas id="canvas" style="display:none;"></canvas>
          </div>
          <div class="btn-group-custom d-flex justify-content-center">
            <button type="button" class="btn btn-primary mr-2" id="uload">Upload</button>
            <button type="button" class="btn btn-success" id="send">Predict</button>
          </div>
          <input type="hidden" id="url" value="../predict"/>
          <input type="file" id="fileinput" style="display:none;"/>
        </div>
      </div>
    </div>

    <!-- Results Section -->
    <div class="col-md-6">
      <div class="card p-4">
        <h5 class="text-center mb-3">ðŸ“Š Prediction Results</h5>
        <div class="row">
          <div class="col-md-6">
            <div class="results-box text-center" id="res-img"></div>
          </div>
          <div class="col-md-6">
            <div class="results-box" id="res-json"><pre></pre></div>
          </div>
        </div>
        <div class="loader mt-3" id="loading"></div>
      </div>
    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
var base_data = "";

function sendRequest(base64Data){
  var url = $("#url").val();
  $("#loading").show();
  $.ajax({
    url : url,
    type: "post",
    cache: false,
    async: true,
    crossDomain: true,
    headers: {'Content-Type': 'application/json'},
    data: JSON.stringify({image: base64Data}),
    success: function(res){
      $("#res-json").html("<pre>" + JSON.stringify(res[0], undefined, 2) + "</pre>");
      try{
        var imageData = res[1].image;
        if(imageData && imageData.length > 100){
          $("#res-img").html("<img src='data:image/jpeg;base64," + imageData + "' class='img-fluid rounded' />");
        }
      } catch(e){}
      $("#loading").hide();
    }
  });
}

$(document).ready(function(){
  $("#loading").hide();

  $('#send').click(function(){ sendRequest(base_data); });
  $('#uload').click(function(){ $('#fileinput').trigger('click'); });

  $("#fileinput").change(function(){
    if (this.files && this.files[0]){
      var reader = new FileReader();
      reader.onload = function (e){
        var url = e.target.result;
        var img = new Image();
        img.onload = function(){
          var canvas = document.createElement('canvas');
          var ctx = canvas.getContext('2d');
          canvas.height = this.height;
          canvas.width = this.width;
          ctx.drawImage(this, 0, 0);
          base_data = canvas.toDataURL('image/jpeg', 1.0).replace(/^data:image.+;base64,/, '');
        };
        img.src = url;
        $('#photo').attr('src', url).show();
        $('#video').hide();
      }
      reader.readAsDataURL(this.files[0]);
    }
  });
});
</script>
</body>
</html>
